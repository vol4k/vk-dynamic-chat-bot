const express = require('express')
const bodyParser = require('body-parser')
const Markup = require('node-vk-bot-api/lib/markup');
const Scene = require('node-vk-bot-api/lib/scene')
const Session = require('node-vk-bot-api/lib/session')
const Stage = require('node-vk-bot-api/lib/stage')
const VkBot  = require('node-vk-bot-api')
 
const app = express()
const bot = new VkBot({
  confirmation: '',
  token: ''
})

//api callback 5.120

//#################################################################################################//
//#################################################################################################//
//####################################      –û–ü–ò–°–ê–ù–ò–ï –°–¶–ï–ù      ####################################//
//#################################################################################################//
//#################################################################################################//


const menu = new Scene('menu',
  (ctx) => {
    // –°—Ü–µ–Ω–∞ 0
    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ –º–µ–Ω—é
    ctx.scene.next()
    ctx.reply(
      '–¢–µ–±—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–æ–æ–±—â–µ—Å—Ç–≤–æ BSTU Game Championshipüî•\n\n' +
      '–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –≤—Å–µ –µ—â–µ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π —ç—Ç–æ–≥–æ —á–∞—Ç-–±–æ—Ç–∞, –Ω–æ –Ω–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Å—è, —Å–∫–æ—Ä–æ –æ–Ω –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Çüòâ\n' +
      '–ê –ø–æ–∫–∞ –¥–µ—Ä–∂–∏ –ø–µ—á–µ–Ω—å–∫—É üç™',
      'photo-171865957_456239018'
    )
    console.log(`\t-–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å https://vk.com/id${ctx.message.from_id} –Ω–∞—á–∞–ª –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º`)
    printMenu(ctx.message.from_id)
    ctx.session.is_exit = 0
  },
  (ctx) => {
    // –°—Ü–µ–Ω–∞ 1
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫
    switch(ctx.message.text){
      case '1':
        whatIs(ctx.message.from_id)
        break
      case '2':
        whatNext(ctx.message.from_id)
        break
      case '3':
        inviteVolunteer(ctx.message.from_id)
        break
      case '4':
        invitePlayer(ctx.message.from_id)
        break
      case '5':
        FAQ(ctx.message.from_id)
        break
      case '/menu':
      case '–ü–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é':
        printMenu(ctx.message.from_id)
        break
      case '/exit':
        bot.sendMessage(ctx.message.from_id,'–ï—â–µ —É–≤–∏–¥–∏–º—Å—è)')
        ctx.session.is_exit=1
        console.log(`\t-–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å https://vk.com/id${ctx.message.from_id} –∑–∞–∫–æ–Ω—á–∏–ª –¥–∏–∞–ª–æ–≥ —Å –±–æ—Ç–æ–º`)
        ctx.scene.leave()
        break
      default:
        bot.sendMessage(ctx.message.from_id,'–ù–µ –ø–æ–Ω–∏–º–∞—é –æ —á–µ–º —ç—Ç–æ —Ç—ãüòÖ')
      }
    },
)
const session = new Session()
const stage = new Stage(menu)
 
bot.use(session.middleware())
bot.use(stage.middleware())

//#################################################################################################//
//#################################################################################################//
//##################################      –®–ê–ë–õ–û–ù–´ –ü–û–í–ï–î–ï–ù–ò–ô      ##################################//
//#################################################################################################//
//#################################################################################################//

function whatIs(user_id){
  bot.sendMessage(user_id,
    '–ó–¥–µ—Å—å –±—É–¥—É—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, —á—Ç–æ —Ç–∞–∫–æ–µ BSTU GAME Championship'
  )
}

function whatNext(user_id){
  bot.sendMessage(user_id,
    '–ó–¥–µ—Å—å –±—É–¥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ –¥–Ω–µ–π\n'+
    '–∞ —Ç–∞–∫–∂–µ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è(–≤–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –±—É–¥—É—Ç —Å–∫—Ä–∏–Ω—ã —Ç—É—Ä–Ω–∏—Ä–Ω—ã—Ö —Å–µ—Ç–æ–∫)'
  )
}

function inviteVolunteer(user_id){
  bot.sendMessage(user_id,
    '–ó–¥–µ—Å—å –±—É–¥—É—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∂–µ–ª–∞—é—â–∏—Ö —Å—Ç–∞—Ç—å –≤–æ–ª–æ–Ω—Ç–µ—Ä–∞–º–∏'
  )
}

function invitePlayer(user_id){
  bot.sendMessage(user_id,
    '–ó–¥–µ—Å—å –±—É–¥—É—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞(–∫–æ–º–∞–Ω–¥—ã)'+
    '\n—Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –∑–∞–Ω–µ—Å–µ–Ω–∏–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö'
  )
}

function FAQ(user_id){
  bot.sendMessage(user_id,
    '–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫(–∏–ª–∏ –±–µ—Å–µ–¥—É)'+
    '–≤ –∫–æ—Ç–æ—Ä–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã'
  )
}

function printMenu(user_id){
  bot.sendMessage(user_id,
    '1‚É£\n–ß—Ç–æ —Ç–∞–∫–æ–µ BSTU Game ChampionshipüèÜ\n\n'+
    '2‚É£\n–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—èüí¨\n\n'+
    '3‚É£\n–•–æ—á—É –≤ –≤–æ–ª–æ–Ω—Ç–µ—Ä—ãüëª\n\n'+
    '4‚É£\n–•–æ—á—É –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ —É—á–∞—Å—Ç–Ω–∏–∫üèÖ\n\n'+
    '5‚É£\n–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ãüÜò\n\n'+
    '* –ß—Ç–æ–±—ã —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—â–µ —Ä–∞–∑ –Ω–∞–ø–∏—à–∏ /menu',
    null,
    Markup.keyboard([
      Markup.button('1','primary'),
      Markup.button('2','primary'),
      Markup.button('3','positive'),
      Markup.button('4','positive'),
      Markup.button('5','primary'),
      Markup.button('6','negative')
    ]).oneTime()
  )
}

//#################################################################################################//
//#################################################################################################//
//##############################      –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–õ–Æ–ß–ï–í–´–• –§–†–ê–ó      ##############################//
//#################################################################################################//
//#################################################################################################//
 
bot.on((ctx) => {
  ctx.scene.enter('menu')
})

//#################################################################################################//
//#################################################################################################//
//#####################################      –ó–ê–ü–£–°–ö –ë–û–¢–ê      #####################################//
//#################################################################################################//
//#################################################################################################//

app.use(bodyParser.json())
 
app.post('/', bot.webhookCallback)
 
app.listen(8080)

console.log('\t-–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω')